### PRO級の広告バリエーションビルダーを作りたい

### タスク
ユーザーがアップロードした「サンプル広告（sampleAd）」に基づき、「同一のスタイル/サイズ/レイアウト」を持つバリエーション広告画像を一括生成します。サンプル内のメイン商品を、「テキストで記述された商品」または「ユーザーがアップロードした商品画像」のいずれかを用いて逐次置き換えます。

すべての出力物は、リアルかつ自然なライティング、クリーンな切り抜き（背景除去）、自然な影を維持し、元のメイン商品の位置を完全に覆う必要があります。**残留物や画像の破綻（アラ）**があってはなりません。

## 行動規範
1. スタイルの一貫性： 背景、構図、色調（カラートーン）、フォントスタイル、コピー（テキスト）の配置などは、すべてサンプル広告に準拠します。置き換えるのはメイン商品のみです。

2. サイズの一貫性： 出力画像の解像度とアスペクト比は、サンプル広告と完全に同一である必要があります。

3. クリーンな置き換え： まずサンプルのメイン商品を検出し除去（インペインティング）した後、新しい商品を配置します。その際、自然な遠近感（パース）、接地影や投影、エッジのアンチエイリアス処理、自然な反射を備えている必要があります。

4. 光と環境の一貫性： 新しい商品の明るさ、光の方向、色温度、反射、被写界深度は、サンプル広告全体の光環境（ライトフィールド）と一致させる必要があります。違和感や「貼り付けた」ような見た目を避けてください。

## バッチ処理ルール
* promptsText の使用： 各行を1つの商品説明とみなし、1行ごとに1枚の結果画像を生成します。

* productImages の使用： 1枚の商品画像ごとに1枚の結果画像を生成します。

## 排他利用：
両方を同時に使用することはできません。同時に両方が入力された場合は、エラーを返し、ユーザーにどちらか一方を選択するよう要求してください。

## メイン商品の配置
可能な限り、サンプル内の元のメイン商品の位置と比率で置き換えます。視覚的に自然になるよう、必要に応じて拡大縮小/回転を微調整します。

## 完全な上書き
元のメイン商品の残像、混入、ゴースト（二重写し）が発生しないようにします。エッジの移行（境界）は滑らかである必要があります。

## ダウンロード可能な出力
各出力画像は個別にダウンロード可能にし、「すべてをZIPでダウンロード」オプションを提供します。ファイル名にはシーケンス番号とソース（promptまたはimage）を含めます。

## 厳格な検証
 入力に対して完全なチェックを行います（エラー処理の項を参照）。規格に合わない場合は、直ちに status="error" と明確なメッセージを返します。

## モデルに関する推奨事項
* 「メイン商品の除去＋置き換え」には、インペインティング（inpainting） または 制約付き合成（constrained composition） を優先的に採用してください。

* 必要に応じて、先に 主体のセグメンテーション（segment/mask） 推論を実行し、その後に合成を行います。


##　Copliot会話内容１
- サンプル広告の想定種類: 商品カテゴリはスキンケア/コスメがメインに。植物や木由来の自然原料、上品なイメージ
- 出力フォーマット: PNGとJPEGで選択できるように
- バッチ規模: 1ジョブあたり最大生成枚数の希望はありますか？10枚
- 検証閾値: アーティファクトスコアなどの基準値をどの程度に設定しますか？違和感を感じつらいくらいでよい

##　Copliot会話内容２
- 色パレット：日本ブランドの「BAUM」や「SHIRO」に参考してください。
- フォント：雰囲気近いフォント（日本語や英語）がいくつかの選択肢を作って、オプションとして選択可能にしよう。
- 自然素材の扱い：許容範囲内でOK